<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Stock AutomÃ¡tico</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:#e5e7eb
}
.container{max-width:1200px;margin:auto;padding:24px}

h1{margin:0 0 6px;font-size:28px}
.subtitle{opacity:.8;margin-bottom:20px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px
}

.card{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:18px;
  padding:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.35)
}

input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #334155;
  background:#020617;
  color:#e5e7eb
}

button{
  padding:10px 14px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer
}

.btn-primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617}
.btn-secondary{background:#334155;color:white}
.btn-danger{background:#ef4444;color:white}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
  font-size:14px
}

th,td{
  padding:10px;
  text-align:center;
  border-bottom:1px solid #1f2937
}

th{
  background:#020617;
  position:sticky;
  top:0
}

.sell-box{
  display:flex;
  gap:6px;
  justify-content:center
}

.sell-box input{
  width:70px;
  padding:6px
}

footer{text-align:center;margin-top:20px;opacity:.6}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ“¦ Control de Stock AutomÃ¡tico</h1>
  <p class="subtitle">Inventario simple con salida de productos por ventas</p>

  <div class="grid">

    <div class="card">
      <h3>Nuevo Producto</h3>
      <div style="display:grid;gap:10px">
        <input type="text" id="name" placeholder="Producto">
        <input type="number" id="quantity" placeholder="Cantidad inicial">
        <input type="number" id="buy" placeholder="Precio compra ($)">
        <input type="number" id="sell" placeholder="Precio venta ($)">
        <button class="btn-primary" onclick="addProduct()">Agregar Producto</button>
      </div>
    </div>

    <div class="card">
      <h3>Inventario</h3>
      <button class="btn-primary" style="margin-bottom:10px" onclick="downloadCSV()">
        Descargar reporte Excel
      </button>

      <table class="table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Compra</th>
            <th>Venta</th>
            <th>Vender</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

  </div>

  <footer>Hecho en HTML, CSS y JavaScript</footer>
</div>

<script>
let products = JSON.parse(localStorage.getItem('stock')) || [];

function addProduct(){
  const name = document.getElementById('name').value.trim();
  const quantity = parseInt(document.getElementById('quantity').value);
  const buy = parseFloat(document.getElementById('buy').value);
  const sell = parseFloat(document.getElementById('sell').value);

  if(!name || isNaN(quantity) || isNaN(buy) || isNaN(sell)){
    alert('Completa todos los campos');
    return;
  }

  products.push({name, quantity, buy, sell});
  save();

  document.getElementById('name').value='';
  document.getElementById('quantity').value='';
  document.getElementById('buy').value='';
  document.getElementById('sell').value='';
}

function sellProduct(index){
  const input = document.getElementById(`sell-${index}`);
  const amount = parseInt(input.value);

  if(isNaN(amount) || amount <= 0) return;

  if(products[index].quantity < amount){
    alert('No hay suficiente stock');
    return;
  }

  products[index].quantity -= amount;
  save();
}

function deleteProduct(i){
  products.splice(i,1);
  save();
}

function save(){
  localStorage.setItem('stock', JSON.stringify(products));
  render();
}

function render(){
  const tbody = document.getElementById('tbody');
  tbody.innerHTML='';

  products.forEach((p,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.quantity}</td>
      <td>$${p.buy.toFixed(2)}</td>
      <td>$${p.sell.toFixed(2)}</td>
      <td>
        <div class="sell-box">
          <input type="number" id="sell-${i}" min="1" placeholder="Cant">
          <button class="btn-secondary" onclick="sellProduct(${i})">OK</button>
        </div>
      </td>
      <td>
        <button class="btn-danger" onclick="deleteProduct(${i})">X</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* EXPORTACIÃ“N EXCEL CORRECTA */
function downloadCSV(){
  const BOM = '\uFEFF'; // clave para Excel Windows

  let tsv = BOM + 
    'Producto\tCantidad\tPrecio Compra\tPrecio Venta\r\n';

  products.forEach(p=>{
    tsv += `${p.name}\t${p.quantity}\t${p.buy}\t${p.sell}\r\n`;
  });

  const blob = new Blob(
    [tsv],
    { type:'text/tab-separated-values;charset=utf-8;' }
  );

  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'stock.xlsx-compatible.tsv';
  link.click();
}

render();
</script>
</body>
</html>