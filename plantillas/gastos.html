<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control de Gastos Personales</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *{box-sizing:border-box;font-family:'Inter',sans-serif}
    body{margin:0;min-height:100vh;background:linear-gradient(135deg,#0f172a,#1e293b);color:#e5e7eb}
    .container{max-width:1200px;margin:auto;padding:24px}h1{margin:0 0 6px;font-size:28px}
.subtitle{opacity:.8;margin-bottom:20px}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.card{background:#020617;border:1px solid #1f2937;border-radius:18px;padding:18px;box-shadow:0 10px 25px rgba(0,0,0,.35)}

input,select{width:100%;padding:12px;border-radius:10px;border:1px solid #334155;background:#020617;color:#e5e7eb}

/* Calendario blanco */
input[type="datetime-local"]{
  background:#ffffff;
  color:#020617;
}

button{padding:12px 16px;border:none;border-radius:10px;font-weight:600;cursor:pointer}
.btn-primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617}
.btn-secondary{background:#334155;color:white}
.btn-danger{background:#ef4444;color:white}

table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
th,td{padding:10px;text-align:center;border-bottom:1px solid #1f2937}
th{background:#020617;position:sticky;top:0}

.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px}
.stat{background:#020617;border:1px solid #1f2937;border-radius:14px;padding:14px;text-align:center}
.stat h3{margin:0;font-size:13px;opacity:.8}
.stat p{margin:6px 0 0;font-size:20px;font-weight:700}

footer{text-align:center;margin-top:20px;opacity:.6}

  </style>
</head>
<body>
<div class="container">
  <h1>游눯 Control de Gastos Personales</h1>
  <p class="subtitle">Ingresos, gastos, ahorro autom치tico y an치lisis visual</p>  <div class="grid">
    <div class="card">
      <h3>Registrar Movimiento</h3>
      <div style="display:grid;gap:10px">
        <input type="datetime-local" id="datetime"><select id="type">
      <option value="ingreso">Ingreso</option>
      <option value="gastoFijo">Gasto Fijo</option>
      <option value="gastoVariable">Gasto Variable</option>
    </select>

    <select id="category"></select>

    <div style="display:flex;gap:8px">
      <input type="text" id="newCategory" placeholder="Nueva categor칤a">
      <button class="btn-secondary" onclick="addCategory()">+</button>
    </div>

    <input type="text" id="description" placeholder="Descripci칩n">
    <input type="number" id="amount" placeholder="Monto ($)">

    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn-primary" onclick="addTransaction()">Agregar</button>
      <button class="btn-secondary" onclick="downloadCSV()">Descargar CSV</button>
    </div>
  </div>
</div>

<div class="card">
  <h3>Distribuci칩n de Gastos</h3>
  <canvas id="chart"></canvas>
</div>

  </div>  <div class="card" style="margin-top:16px">
    <h3>Historial</h3>
    <table>
      <thead>
        <tr>
          <th>Fecha</th><th>Tipo</th><th>Categor칤a</th><th>Descripci칩n</th><th>Monto</th><th></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>  <div class="stats">
    <div class="stat"><h3>Ingresos</h3><p id="totalIncome">$0</p></div>
    <div class="stat"><h3>Gastos Totales</h3><p id="totalExpenses">$0</p></div>
    <div class="stat"><h3>Ahorro Mensual</h3><p id="savings">$0</p></div>
  </div>  <footer>Hecho en HTML, CSS y JavaScript</footer>
</div><script>
let transactions = JSON.parse(localStorage.getItem('finance')) || [];
let categories = JSON.parse(localStorage.getItem('categories')) || ['Comida','Alquiler','Auto','Ocio'];
let chart;

function loadCategories(){
  const select=document.getElementById('category');
  select.innerHTML='';
  categories.forEach(c=>{
    const opt=document.createElement('option');
    opt.value=c; opt.textContent=c;
    select.appendChild(opt);
  });
}

function addCategory(){
  const name=document.getElementById('newCategory').value.trim();
  if(!name) return;
  if(categories.includes(name)) return alert('La categor칤a ya existe');
  categories.push(name);
  localStorage.setItem('categories',JSON.stringify(categories));
  document.getElementById('newCategory').value='';
  loadCategories();
  renderChart();
}

function addTransaction(){
  const datetime = datetimeInput().value;
  const type = typeInput().value;
  const category = categoryInput().value;
  const description = descriptionInput().value;
  const amount = parseFloat(amountInput().value);

  if(!datetime || !description || isNaN(amount)){
    alert('Completa todos los campos');
    return;
  }

  transactions.push({datetime,type,category,description,amount});
  save();
  descriptionInput().value='';
  amountInput().value='';
}

function deleteTransaction(i){transactions.splice(i,1);save();}

function save(){localStorage.setItem('finance',JSON.stringify(transactions));render();}

function render(){renderTable();calculate();renderChart();}

function renderTable(){
  const tbody=document.getElementById('tbody');
  tbody.innerHTML='';
  transactions.forEach((t,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${new Date(t.datetime).toLocaleString()}</td><td>${t.type}</td><td>${t.category}</td><td>${t.description}</td><td>$${t.amount.toFixed(2)}</td><td><button class='btn-danger' onclick='deleteTransaction(${i})'>X</button></td>`;
    tbody.appendChild(tr);
  });
}

function calculate(){
  let income=0, expenses=0;
  transactions.forEach(t=>{
    if(t.type==='ingreso') income+=t.amount;
    else expenses+=t.amount;
  });
  const savings = income - expenses;
  document.getElementById('totalIncome').textContent=`$${income.toFixed(2)}`;
  document.getElementById('totalExpenses').textContent=`$${expenses.toFixed(2)}`;
  document.getElementById('savings').textContent=`$${savings.toFixed(2)}`;
}

function renderChart(){
  const catTotals={};
  categories.forEach(c=>catTotals[c]=0);

  transactions.forEach(t=>{
    if(t.type!=='ingreso'){
      if(!catTotals[t.category]) catTotals[t.category]=0;
      catTotals[t.category]+=t.amount;
    }
  });

  const data={labels:Object.keys(catTotals),datasets:[{data:Object.values(catTotals)}]};

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('chart'),{type:'doughnut',data});
}

function downloadCSV(){
  let csv='Fecha,Tipo,Categor칤a,Descripci칩n,Monto\n';
  transactions.forEach(t=>{
    csv+=`"${new Date(t.datetime).toLocaleString()}",${t.type},${t.category},"${t.description}",${t.amount}\n`;
  });

  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='reporte_gastos.csv';
  link.click();
}

const datetimeInput=()=>document.getElementById('datetime');
const typeInput=()=>document.getElementById('type');
const categoryInput=()=>document.getElementById('category');
const descriptionInput=()=>document.getElementById('description');
const amountInput=()=>document.getElementById('amount');

loadCategories();
render();
</script></body>
</html>
